global:
  resolve_timeout: 5m

# ═══════════════════════════════════════════════════════════
# ROUTING CONFIGURATION
# ═══════════════════════════════════════════════════════════
route:
  receiver: "default"
  group_by: ['alertname', 'domain', 'severity', 'instance']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  
  # Route critical alerts with higher priority
  routes:
    - match:
        severity: critical
      receiver: "critical-alerts"
      group_wait: 10s
      repeat_interval: 1h
      continue: false
    
    - match:
        severity: warning
      receiver: "warning-alerts"
      group_wait: 30s
      repeat_interval: 4h
      continue: false
    
    - match:
        severity: info
      receiver: "info-alerts"
      group_wait: 5m
      repeat_interval: 12h
      continue: false

# ═══════════════════════════════════════════════════════════
# RECEIVERS (NOTIFICATION CHANNELS)
# ═══════════════════════════════════════════════════════════
receivers:
  - name: "default"
    # Default webhook for all alerts
    webhook_configs:
      - url: 'http://localhost:5001/webhook/alerts'
        send_resolved: true
        http_config:
          follow_redirects: true
    
  - name: "critical-alerts"
    # Critical alerts - multiple channels for redundancy
    webhook_configs:
      - url: 'http://localhost:5001/webhook/critical'
        send_resolved: true
        max_alerts: 10
    # Add email/Slack here when configured
    
  - name: "warning-alerts"
    webhook_configs:
      - url: 'http://localhost:5001/webhook/warning'
        send_resolved: true
    
  - name: "info-alerts"
    webhook_configs:
      - url: 'http://localhost:5001/webhook/info'
        send_resolved: true

# ═══════════════════════════════════════════════════════════
# INHIBITION RULES (Prevent Alert Storms)
# ═══════════════════════════════════════════════════════════
inhibit_rules:
  # If critical alert is firing, suppress warnings for same alert
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
  
  # If node is down, suppress all other alerts from that node
  - source_match:
      alertname: 'NodeDown'
    target_match_re:
      alertname: '.*'
    equal: ['instance']
  
  # If disk is full, suppress high disk usage warnings
  - source_match:
      alertname: 'DiskAlmostFull'
    target_match:
      alertname: 'DiskSpaceWarning'
    equal: ['instance', 'device']

